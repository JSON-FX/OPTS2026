# Story 0.1.1: Pre-Migration Setup & Component Installation

## Status

Approved

## Story

**As a** Frontend Developer,
**I want** to verify the shadcn/ui environment, install all missing components via MCP, and create baseline documentation and screenshots,
**so that** I have a complete foundation and testing baseline for the shadcn/ui migration across all pages.

## Acceptance Criteria

1. MCP shadcn tool verified working and can connect to project registries
2. All core shadcn/ui components installed in `resources/js/components/ui/`
3. DataTable components fetched and documented with usage examples
4. Baseline screenshots captured for all 30+ existing pages using Playwright
5. Component mapping document created at `docs/shadcn-component-mapping.md` showing legacy → shadcn equivalents
6. lib/utils.ts configured with cn() helper function
7. CSS variables properly set in resources/css/app.css for theming
8. TypeScript compilation successful with new components (`npm run build` passes)

## Tasks / Subtasks

- [ ] **Task 1: Verify MCP Shadcn Tool and Project Configuration** (AC: 1, 6, 7)
  - [ ] Execute `mcp__shadcn__get_project_registries()` to verify MCP connection
  - [ ] Verify `components.json` configuration is correct (new-york style, correct paths)
  - [ ] Check `lib/utils.ts` exists with `cn()` helper function combining `clsx` and `tailwind-merge`
  - [ ] Verify CSS variables in `resources/css/app.css` include shadcn theme variables
  - [ ] Run `npx tsc` to ensure TypeScript compiles without errors
  - [ ] Document current shadcn component inventory (11 existing components)

- [ ] **Task 2: Fetch Missing Core Shadcn Components via MCP** (AC: 2)
  - [ ] Use `mcp__shadcn__list_items_in_registries({ registries: ["@shadcn"] })` to view all available components
  - [ ] Use `mcp__shadcn__get_add_command_for_items()` to fetch missing core components:
    - Form, Label, Select, Textarea, Checkbox, Card, Separator
    - AlertDialog, Dialog, NavigationMenu, Sheet, Avatar, Tabs
    - Switch, Popover, Command, DatePicker, ScrollArea
  - [ ] Execute the returned CLI commands to install components
  - [ ] Verify all new components appear in `resources/js/components/ui/`
  - [ ] Run `npm run build` to verify TypeScript compilation succeeds
  - [ ] Test one component (Button) in isolation to verify styling works

- [ ] **Task 3: Fetch DataTable Components and Examples** (AC: 3)
  - [ ] Use `mcp__shadcn__search_items_in_registries({ registries: ["@shadcn"], query: "data-table" })` to find DataTable
  - [ ] Use `mcp__shadcn__get_item_examples_from_registries({ registries: ["@shadcn"], query: "data-table-demo" })` to fetch usage examples
  - [ ] Document DataTable structure and required features in migration notes
  - [ ] Verify `@tanstack/react-table` is installed (already v8.21.3 per package.json)
  - [ ] Create DataTable architecture notes with column definitions, toolbar, pagination patterns

- [ ] **Task 4: Create Baseline Screenshots with Playwright MCP** (AC: 4)
  - [ ] Create `baseline/` directory in project root for screenshots
  - [ ] Use `mcp__playwright__browser_install()` if needed to set up Playwright
  - [ ] Create screenshot capture script for all pages:
    - Auth pages: /login, /register, /forgot-password, /reset-password
    - Dashboard: /dashboard
    - Admin pages: /admin/users, /admin/repositories/*
    - Procurement pages: /procurements, /procurements/create, /procurements/{id}
    - Transaction pages: /purchase-requests/*, /purchase-orders/*, /vouchers/*, /transactions
  - [ ] For each page, execute:
    - `mcp__playwright__browser_navigate({ url: page })`
    - `mcp__playwright__browser_take_screenshot({ path: baseline/${page}.png })`
    - `mcp__playwright__browser_console_messages()` to capture initial console state
  - [ ] Document page inventory and any console errors found in baseline state
  - [ ] Save console baseline report at `baseline/console-baseline.json`

- [ ] **Task 5: Create Component Mapping Documentation** (AC: 5)
  - [ ] Create `docs/shadcn-component-mapping.md` with mapping table
  - [ ] Document legacy → shadcn mappings:
    - TextInput → Input
    - PrimaryButton → Button (variant="default")
    - SecondaryButton → Button (variant="secondary")
    - DangerButton → Button (variant="destructive")
    - InputLabel → Label
    - InputError → FormMessage (within FormItem)
    - Modal → Dialog
    - Dropdown → DropdownMenu
    - ResponsiveNavLink → NavigationMenu + Sheet
  - [ ] Document prop interface changes for each mapping
  - [ ] Add import path migration notes (e.g., `@/Components/*` → `@/components/ui/*`)
  - [ ] Include code examples for complex migrations (Forms, DataTable)

- [ ] **Task 6: Run Audit Checklist and Verification** (AC: 8)
  - [ ] Execute `mcp__shadcn__get_audit_checklist()` to verify setup
  - [ ] Run `npm run build` to verify production build succeeds
  - [ ] Run `npx tsc` to verify no TypeScript errors
  - [ ] Check `npm run dev` starts without errors
  - [ ] Verify no console errors when navigating to dashboard
  - [ ] Document any warnings or issues found

## Dev Notes

### Story Overview

Story 0.1.1 is the **foundation story** for the entire shadcn/ui migration (Epic 0.1). This story prepares the environment by:
1. Verifying MCP tool integration works correctly
2. Installing ALL missing shadcn/ui components upfront (vs incremental installation)
3. Creating comprehensive baseline screenshots for visual regression testing
4. Documenting the component mapping for all future migration stories

**Why This Approach:**
- **Complete Component Library:** Having all components available from the start prevents delays in later stories
- **Visual Regression Baseline:** Screenshots captured now will be compared after layout/page migrations to detect unintended changes
- **Clear Migration Path:** Component mapping document provides a reference for all developers

[Source: docs/prd/epic-0.1-shadcn-foundation-global-components.md#Story-0.1.1]

### Previous Story Insights

**No previous stories** - This is the first story in Epic 0.1 (and first story in the shadcn migration).

However, from Story 2.10 (latest completed story), we know:
- Shadcn components (Button, Input, Table, DropdownMenu, Accordion, Select) were manually created due to npm peer dependency conflicts with Vite 7.1.12
- `@tanstack/react-table` is already installed (v8.21.3)
- `use-debounce`, `date-fns` already installed for previous features
- Several Radix UI dependencies already present

**Key Insight:** The project has 11 shadcn components already created, but no systematic inventory or mapping exists. This story will formalize and complete the component library.

[Source: docs/stories/2.10.transaction-list-search-functionality.md#Completion-Notes]

### Architecture Context

#### MCP Tool Integration

**Shadcn MCP Tool:**
The shadcn MCP tool provides AI-assisted component installation directly from Claude. Available MCP functions:

```typescript
// Verify project configuration
mcp__shadcn__get_project_registries() // Returns configured registries

// List all available components
mcp__shadcn__list_items_in_registries({
  registries: ["@shadcn"],
  limit: 50
})

// Search for specific components
mcp__shadcn__search_items_in_registries({
  registries: ["@shadcn"],
  query: "form"
})

// View detailed component information
mcp__shadcn__view_items_in_registries({
  items: ["@shadcn/button", "@shadcn/input"]
})

// Get installation command
mcp__shadcn__get_add_command_for_items({
  items: ["@shadcn/button", "@shadcn/card"]
}) // Returns: npx shadcn@latest add button card

// Get usage examples
mcp__shadcn__get_item_examples_from_registries({
  registries: ["@shadcn"],
  query: "button-demo"
})

// Run audit checklist
mcp__shadcn__get_audit_checklist()
```

**Playwright MCP Tool:**
The Playwright MCP tool provides browser automation for testing directly from Claude. Key functions for this story:

```typescript
// Install Playwright browsers
mcp__playwright__browser_install()

// Navigate to page
mcp__playwright__browser_navigate({ url: "/dashboard" })

// Capture screenshot
mcp__playwright__browser_take_screenshot({
  path: "baseline/dashboard.png",
  fullPage: true
})

// Check console messages
mcp__playwright__browser_console_messages()

// Test responsive at different viewports
mcp__playwright__browser_resize({ width: 375, height: 812 })
```

[Source: docs/shadcn-migration-checklist.md#MCP-Commands-Reference]

#### Project Configuration

**components.json Configuration:**
Already configured correctly:
```json
{
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "resources/css/app.css",
    "baseColor": "slate",
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui"
  }
}
```

**lib/utils.ts:**
Already exists with cn() helper:
```typescript
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

**Existing Shadcn Components (11 total):**
- accordion.tsx
- badge.tsx
- button.tsx
- dropdown-menu.tsx
- input.tsx
- select.tsx
- skeleton.tsx
- table.tsx
- toast.tsx
- toaster.tsx
- tooltip.tsx

**Missing Core Components (to be installed):**
Form, Label, Textarea, Checkbox, Card, Separator, AlertDialog, Dialog, NavigationMenu, Sheet, Avatar, Tabs, Switch, Popover, Command, DatePicker, ScrollArea, and more

[Source: docs/architecture-shadcn-migration.md#Existing-Project-Analysis, project inspection]

#### Frontend Architecture Integration

**Component Organization:**
```
resources/js/
├── components/                # shadcn components (lowercase)
│   ├── ui/                   # Core shadcn primitives
│   ├── layouts/              # Future: migrated layouts
│   ├── composite/            # Future: business components
│   └── patterns/             # Future: reusable patterns
├── Components/               # DEPRECATED: Legacy components (to be removed)
├── Layouts/                  # Current layouts (will migrate to components/layouts)
├── Pages/                    # Inertia pages (unchanged)
├── lib/                      # Utilities (cn() helper)
├── hooks/                    # Custom React hooks
└── types/                    # TypeScript definitions
```

**Import Path Strategy:**
```typescript
// Current mixed pattern (BAD)
import TextInput from '@/Components/TextInput'
import { Button } from '@/components/ui/button'

// Target pattern (GOOD)
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
```

[Source: docs/architecture/frontend-architecture.md#Directory-Structure]

#### Testing Strategy for Baseline Capture

**Pages to Screenshot (30+ total):**

**Authentication Pages (4):**
- /login
- /register
- /forgot-password
- /reset-password

**Dashboard (1):**
- /dashboard

**Admin Pages (10+):**
- /admin/users
- /admin/users/create
- /admin/repositories/offices
- /admin/repositories/suppliers
- /admin/repositories/particulars
- /admin/repositories/departments
- /admin/repositories/fund-types
- /admin/repositories/workflow-stages

**Procurement Pages (4):**
- /procurements
- /procurements/create
- /procurements/{id}
- /procurements/{id}/edit

**Transaction Pages (12+):**
- /purchase-requests/create
- /purchase-requests/{id}
- /purchase-orders/create
- /purchase-orders/{id}
- /vouchers/create
- /vouchers/{id}
- /transactions

**Viewport Sizes for Responsive Testing:**
- Mobile: 375x812
- Tablet: 768x1024
- Desktop: 1920x1080

[Source: docs/shadcn-migration-checklist.md#Phase-1-Pre-Migration-Setup, docs/architecture/testing-strategy.md]

### Component Mapping Table

This table will be created in Task 5 at `docs/shadcn-component-mapping.md`:

| Legacy Component | Shadcn Component | Variant/Props | Import Path Change |
|-----------------|------------------|---------------|-------------------|
| TextInput | Input | - | @/Components/TextInput → @/components/ui/input |
| PrimaryButton | Button | variant="default" | @/Components/PrimaryButton → @/components/ui/button |
| SecondaryButton | Button | variant="secondary" | @/Components/SecondaryButton → @/components/ui/button |
| DangerButton | Button | variant="destructive" | @/Components/DangerButton → @/components/ui/button |
| InputLabel | Label | - | @/Components/InputLabel → @/components/ui/label |
| InputError | FormMessage | Must wrap in FormItem | @/Components/InputError → @/components/ui/form |
| Modal | Dialog | Different prop structure | @/Components/Modal → @/components/ui/dialog |
| Dropdown | DropdownMenu | Already migrated | Already using @/components/ui/dropdown-menu |
| ResponsiveNavLink | NavigationMenu + Sheet | Mobile uses Sheet | New components, no direct legacy |

[Source: docs/architecture-shadcn-migration.md#Component-Mapping-Strategy]

### File Locations

**Files to Create:**
- `baseline/` - Directory for baseline screenshots
- `baseline/console-baseline.json` - Console state documentation
- `docs/shadcn-component-mapping.md` - Component mapping documentation

**Files to Modify:**
- None (this is a setup story - no code modifications)

**Files to Verify:**
- `components.json` - Already configured correctly
- `resources/js/lib/utils.ts` - Already exists with cn() helper
- `resources/css/app.css` - Verify CSS variables present

**Components to Install (in resources/js/components/ui/):**
New components from MCP fetch:
- form.tsx, label.tsx, textarea.tsx, checkbox.tsx
- card.tsx, separator.tsx
- alert-dialog.tsx, dialog.tsx
- navigation-menu.tsx, sheet.tsx, avatar.tsx
- tabs.tsx, switch.tsx, popover.tsx, command.tsx
- scroll-area.tsx, date-picker.tsx
- (and any other missing components discovered via MCP list)

[Source: docs/architecture/unified-project-structure.md, docs/prd/epic-0.1-shadcn-foundation-global-components.md]

### TypeScript Configuration

**Current TypeScript Setup:**
- TypeScript 5.0.2 (strict mode enabled)
- Path aliases configured in tsconfig.json:
  ```json
  {
    "compilerOptions": {
      "paths": {
        "@/*": ["./resources/js/*"]
      }
    }
  }
  ```
- Vite aliases match TypeScript paths

**Component Type Safety:**
All shadcn components use:
- `React.forwardRef` for ref forwarding
- Proper TypeScript interfaces extending React HTML attributes
- `displayName` for debugging
- Variant props via `class-variance-authority`

[Source: docs/architecture/tech-stack.md, docs/architecture/coding-standards.md]

### CSS Variables Configuration

**Required CSS Variables (verify in resources/css/app.css):**
```css
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --radius: 0.5rem;
  }
}
```

These variables are already configured if shadcn components are working.

[Source: docs/architecture-shadcn-migration.md#Global-Configuration-Strategy]

### Risk Considerations

**Risk: MCP Tool Unavailable**
- **Mitigation:** If MCP tools fail, can use manual CLI: `npx shadcn@latest add <component>`
- **Fallback:** Components can be manually copied from shadcn/ui documentation

**Risk: TypeScript Compilation Errors**
- **Mitigation:** Test compilation after each component batch installation
- **Resolution:** Fix type errors immediately before proceeding

**Risk: CSS Variable Conflicts**
- **Mitigation:** Verify CSS variables don't conflict with existing Tailwind setup
- **Resolution:** Adjust variable names if conflicts detected

**Risk: Baseline Screenshot Failures**
- **Mitigation:** Handle 404s gracefully, document pages that don't exist
- **Resolution:** Create baseline only for existing, accessible pages

[Source: docs/architecture-shadcn-migration.md#Top-5-Risks-by-Severity]

## Testing

### Manual Testing Requirements

**MCP Tool Verification:**
1. Run `mcp__shadcn__get_project_registries()` - Should return `["@shadcn"]`
2. Run `mcp__shadcn__list_items_in_registries({ registries: ["@shadcn"], limit: 5 })` - Should return component list
3. Verify components.json is read correctly by MCP tool

**Component Installation Verification:**
1. After installing components, run `npx tsc` - Should compile without errors
2. Run `npm run build` - Should build successfully
3. Navigate to dashboard in browser - Should render without console errors
4. Test one new component (e.g., Card) in isolation page

**Playwright Baseline Verification:**
1. Run `mcp__playwright__browser_install()` - Should install browsers successfully
2. Navigate to /login - Should capture screenshot without errors
3. Check console messages - Should return array of console logs
4. Verify baseline/ directory contains expected screenshots

**Documentation Verification:**
1. Open `docs/shadcn-component-mapping.md` - Should have complete mapping table
2. Verify all legacy components mapped to shadcn equivalents
3. Check import path examples are correct

### Automated Testing

**TypeScript Compilation Test:**
```bash
npx tsc --noEmit
# Expected: Exit code 0, no errors
```

**Build Verification Test:**
```bash
npm run build
# Expected: Build completes successfully, dist/ folder created
```

**Component Import Test:**
Create temporary test file to verify imports work:
```typescript
// test-imports.tsx
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Card } from '@/components/ui/card'
import { Form } from '@/components/ui/form'
// Expected: No TypeScript errors
```

[Source: docs/architecture/testing-strategy.md, docs/shadcn-migration-checklist.md#Phase-2-Core-Component-Installation]

### Success Criteria Verification

**Acceptance Criteria Verification Matrix:**

| AC | Verification Method | Pass Criteria |
|----|-------------------|---------------|
| AC1: MCP tool working | Run MCP commands, get valid responses | Commands return expected data, no errors |
| AC2: Core components installed | Check file count in components/ui/ | 25+ component files present |
| AC3: DataTable documented | Check for DataTable architecture notes | Documentation file created with examples |
| AC4: Baseline screenshots | Check baseline/ directory file count | 30+ screenshots captured |
| AC5: Component mapping doc | Open docs/shadcn-component-mapping.md | File exists with complete mapping table |
| AC6: lib/utils.ts configured | Check file exists and exports cn() | File present, exports working |
| AC7: CSS variables set | Inspect resources/css/app.css | CSS variables block present |
| AC8: TypeScript compiles | Run `npm run build` | Build succeeds, exit code 0 |

[Source: docs/prd/epic-0.1-shadcn-foundation-global-components.md#Story-0.1.1]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-11-04 | 1.0 | Initial story draft created for Epic 0.1, Story 0.1.1 with comprehensive Dev Notes, all 8 acceptance criteria, 6 tasks with detailed subtasks, and complete architecture context from tech-stack.md, frontend-architecture.md, testing-strategy.md, coding-standards.md, unified-project-structure.md, architecture-shadcn-migration.md, and shadcn-migration-checklist.md | Bob (SM) |

## Dev Agent Record

### Agent Model Used

(To be filled by dev agent)

### Debug Log References

(To be filled by dev agent)

### Completion Notes List

(To be filled by dev agent)

### File List

(To be filled by dev agent)

## QA Results

(To be filled by QA agent)
